<!DOCTYPE html>
<html>
    <head><title>Student Registration Form</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="stu-reg-style.css">
    </head>
    <body>
    <br>
    <br>
    <div id="reg-container">
        <button  id="home" onclick="location.href='index.html'">Home</button>   
        <div id="reg-body">
        <h1><u><b>Student Registration Form</b></u></h1>
        <form id="regForm">
            <div>
                <label for="roll"><b>Roll No. :</b></label>
                <input type="text" name="roll" size="56" placeholder="25765XXXX">
            </div>
            <br>
            <br>
            <div class="row">
                <label><b>Student Name :</b></label>
                <div class="pair">
                    <input type="text" name="firstname" placeholder="First Name">
                    <input type="text" name="lastname" placeholder="Last Name">
                </div>
            </div>

            <br>
            <br>
            <div>
                <label for="father_name"><b>Father's Name :</b></label>
                <input type="text" size="56" name="father_name">
            </div>
            <br>
            <br>
            <div>
                <label for="dob"><b>Date of Birth :</b></label>
                <input type="text" name="dob" placeholder="DD-MM-YYYY" size="20">
            </div>
            <br>
            <br>
            <div class="row">
                <label><b>Mobile No. :</b></label>
                <div class="pair">
                    <input type="text" name="mobile" value="+91">
                    <input type="text" name="mobile_rest" placeholder="8345XXXXXX">
                </div>
            </div>
            <br>
            <br>
            <div>
                <label for="email"><b>Email :</b></label>
                <input type="email" name="email" size="56" placeholder="student@example.com">
            </div>
            <br>
            <br>
            <div class="row">
                <label><b>Gender :</b></label>
                <div class="options">
                    <label><input type="radio" name="gender" value="Male"> Male</label>
                    <label><input type="radio" name="gender" value="Female"> Female</label>
                    <label><input type="radio" name="gender" value="Other"> Other</label>
                </div>
            </div>
            <br>
            <br>
            <div class="row">
                <label><b>Department :</b></label>
                <div class="options">
                    <label><input type="radio" name="department" value="CSE"> CSE</label>
                    <label><input type="radio" name="department" value="IT"> IT</label>
                    <label><input type="radio" name="department" value="ECE"> ECE</label>
                    <label><input type="radio" name="department" value="Civil"> Civil</label>
                    <label><input type="radio" name="department" value="Mech"> Mech</label>
                </div>
            </div>
            <br>
            <br>
            <div>
                <label for="course"><b>Course :</b></label>
                <select name="course">
                    <option value="">----- Select Current Course -----</option>
                    <option value="C">C</option>
                    <option value="Java">Java</option>
                    <option value="Python">Python</option>
                    <option value="Full Stack Web Development">Full Stack Web Development</option>
                </select>
            </div>
            <br>
            <br>
            <div>
                <label for="city"><b>City :</b></label>
                <input type="text" name="city" placeholder="Place" size="56">
            </div>
            <br>
            <br>
            <div>
                <label for="address"><b>Address :</b></label>
                <textarea name="address" rows="4" cols="56"></textarea>
            </div>
            <br>
            <br>
            <input type="submit" value="Register">
            <input type="reset" value="Clear">
        </form>
        </div>
        </div>
    </div>
    <script>
            async function submitForm(e){
                e.preventDefault();
                const form = document.getElementById('regForm');
                const fd = new FormData(form);
                const obj = {};
                
                fd.forEach((v,k)=>{
                    if(obj[k]){
                        if(Array.isArray(obj[k])) obj[k].push(v);
                        else obj[k]=[obj[k],v];
                    } else obj[k]=v;
                });

                if(obj.mobile_rest) obj.mobile = (obj.mobile||'') + obj.mobile_rest;
                
                if(!obj.roll  || obj.roll.length<3) {
                    alert('Roll No. is required');
                    return;
                }

                if(!obj.firstname || !obj.lastname) {
                    alert('Name is required');
                    return;
                }
                if(!obj.email || !obj.email.includes('@')) {
                    alert('Valid Email is required');
                    return;
                }
                if(!obj.gender) {
                    alert('Gender is required');
                    return;
                }
                if(!obj.department) {
                    alert('Department is required');
                    return;
                }
                if(!obj.course) {
                    alert('Course is required');
                    return;
                }
                if(!obj.city) {
                    alert('City is required');
                    return;
                }
                if(!obj.mobile || obj.mobile.length<10) {
                    alert('Valid Mobile No. is required');
                    return;
                }
                
                try{
                    const res = await fetch('/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(obj)
                    });
                    if(res.ok){
                        alert('Registered successfully');
                        form.reset();
                        loadUsers();
                    } else {
                        const txt = await res.text();
                        alert('Error: ' + txt);
                    }
                }catch(err){
                    alert('Request failed: ' + err.message);
                }
            }

            document.getElementById('regForm').addEventListener('submit', submitForm);
    </script>
    </body>
</html>